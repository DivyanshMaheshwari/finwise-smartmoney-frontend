<div
  class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-6 relative"
>
  <!-- Generating Loader -->
  <div
    *ngIf="generating"
    class="fixed inset-0 bg-black bg-opacity-60 z-50 flex flex-col justify-center items-center"
  >
    <div
      class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-teal-500"
    ></div>
    <p class="mt-4 text-lg text-teal-300 font-medium">Generating Budget...</p>
  </div>

  <!-- Header -->
  <div class="max-w-4xl mx-auto mb-10">
    <h2 class="text-3xl font-bold text-teal-300 mb-4">Budget Planner</h2>
    <button
      (click)="generateBudget()"
      [disabled]="generating"
      class="bg-teal-600 hover:bg-teal-700 px-6 py-2 rounded-md font-medium shadow disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Generate Budget from Latest Salary
    </button>
  </div>

  <!-- Past Budgets -->
  <div class="max-w-6xl mx-auto">
    <h3 class="text-xl font-semibold text-white mb-6">Past Budgets</h3>

    <!-- Loading -->
    <div
      *ngIf="loading"
      class="text-teal-300 text-center py-10 text-lg animate-pulse"
    >
      Loading past budgets...
    </div>

    <!-- No Data -->
    <div
      *ngIf="!loading && budgets.length === 0"
      class="text-gray-400 text-center py-10"
    >
      No budgets generated yet.
    </div>

    <!-- Budget List -->
    <div *ngIf="!loading && budgets.length > 0" class="grid gap-6">
      <div
        *ngFor="let budget of budgets"
        class="w-full bg-white/5 p-6 rounded-xl border border-white/10 shadow transition hover:shadow-lg relative"
      >
        <!-- Delete Button -->
        <ng-container *ngIf="!deletingIds.has(budget.incomeId); else deleting">
          <button
            (click)="confirmDelete(budget.incomeId)"
            class="absolute top-4 right-4 text-red-400 hover:text-red-600 transition"
            title="Delete"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M6 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z"
                clip-rule="evenodd"
              />
              <path
                fill-rule="evenodd"
                d="M4 5a1 1 0 011-1h10a1 1 0 011 1v1H4V5zm2 3h8v8a2 2 0 01-2 2H8a2 2 0 01-2-2V8z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </ng-container>

        <ng-template #deleting>
          <div class="absolute top-4 right-4">
            <div
              class="h-5 w-5 border-2 border-t-transparent border-teal-400 rounded-full animate-spin"
            ></div>
          </div>
        </ng-template>

        <!-- Budget Content -->
        <div class="grid md:grid-cols-3 gap-4 text-gray-300">
          <p>
            <span class="font-semibold text-teal-300">Salary Date:</span>
            {{ budget.salaryDate | date: 'dd-MMM-yyyy'}}
          </p>
          <p>
            <span class="font-semibold text-teal-300">Salary Amount:</span> ₹{{
              budget.salaryAmount
            }}
          </p>

          <p>
            <span class="font-semibold text-teal-300">Needs:</span> ₹{{
              budget.calculatedNeeds
            }}
          </p>
          <p>
            <span class="font-semibold text-teal-300">Wants:</span> ₹{{
              budget.calculatedWants
            }}
          </p>
          <p>
            <span class="font-semibold text-teal-300">Investments:</span> ₹{{
              budget.calculatedInvestments
            }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <app-confirmation-modal
    [show]="showConfirmModal"
    (confirm)="deleteBudget(pendingDeleteId!)"
    (cancel)="cancelDelete()"
    [loading]="pendingDeleteId !== null && deletingIds.has(pendingDeleteId)"
    [title]="'Delete Budget'"
    [message]="'Are you sure you want to delete this budget entry?'"
    [confirmText]="'Delete'"
    [cancelText]="'Cancel'"
  />
</div>
